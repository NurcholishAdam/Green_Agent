- name: Detect and validate AgentBeats config
  run: |
    if [ -f agentbeats.json ]; then
      echo "Using agentbeats.json"
      jq . agentbeats.json > /dev/null
      jq -e '.queries | type == "array"' agentbeats.json > /dev/null
      jq -e '.image | ascii_downcase == .' agentbeats.json > /dev/null

    elif [ -f agentbeats.yml ]; then
      echo "Using agentbeats.yml"
      yq . agentbeats.yml > /dev/null
      yq '.queries | length > 0' agentbeats.yml > /dev/null
      yq '.image | test("^[a-z0-9./:-]+$")' agentbeats.yml > /dev/null

    else
      echo "âŒ No agentbeats.json or agentbeats.yml found at repo root"
      exit 1
    fi

- run: python scripts/validate_agentbeats.py

